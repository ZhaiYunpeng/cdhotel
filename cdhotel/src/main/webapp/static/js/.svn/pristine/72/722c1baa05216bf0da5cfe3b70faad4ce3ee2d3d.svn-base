Module = {
	init: function() {
		Module.registerBtn_event();
	},
	win_tip: function(str) {
		layui.use('layer', function() {
			var layer = layui.layer;

			layer.msg(str, {
				time: 5000,
				btn: ['ok']
			});
		});
	},
	loginBtn_event: function() {
		var id_val = $("#id_val").val()
		var pwd_val = $("#password_val").val();
		//console.log(id_val + "," + pwd_val);
		//点击登录按钮，向后台发送账号密码数据，直接在html form表单的action把请求发出去
		$.post('http://localhost:8080/map/login.action', {
			"username": id_val,
			"password": pwd_val
		}, function(data) {
			if (data == 1) {
				Module.win_tip("该用户名不存在，请重新输入!");
				//window.location.href = 'http://localhost:8080/map/main/homePage.html';
			} else if (data == 2) {
				Module.win_tip("密码错误，请重新输入!");
				//window.location.href = 'http://localhost:8080/map/main/homePage.html';
			} else if (data == 3) {
				Module.win_tip("该用户名不存在，请重新输入!");
				//window.location.href = 'http://localhost:8080/map/main/homePage.html';
			} else {
				//console.log(data);
				window.location.href = 'http://localhost:8080/map/main/geoCoding.html';
			}
		});
	},
	test_username: function() {
		var username_val = $("#username").val();
		//console.log(username_val);
		if (username_val != "") {
			$.post("../checkusername.action", {
				"username": username_val
			}, function(data) {
				if (data == 1) {
					$("#s1").html("<font color='green'>用户名可以使用</font>");
					$("#submit_form").removeClass("layui-btn-disabled");
				} else if (data == 2) {
					$("#s1").html("<font color='red'>用户名已经被占用</font>");
					$("#submit_form").addClass("layui-btn-disabled");
				}
			});
		}
	},
	registerBtn_event: function() {
		$("#register_btn").on('click', function() {
			layui.use(['layer', 'form', 'element', 'table'], function() {
				var layerEle = layui.layer;
				var form = layui.form;
				var table = layui.table;
				var register_win = layerEle.open({
					type: 1,
					title: '注册信息',
					content: '<div id="test_table" style="width: 280px;height: 220px;">' +
						'<form class="layui-form" action="" style="margin: 20px 0 0 0;">' +
						'<div class="layui-form-item">' +
						'<label class="layui-form-label">昵称</label>' +
						'<div class="layui-input-block">' +
						'<input type="text" id="nickname" name="nickname" required  lay-verify="nickname" placeholder="请输入昵称" autocomplete="off" class="layui-input">' +
						'</div>' +
						'</div>' +
						'<div class="layui-form-item">' +
						'<label class="layui-form-label">用户名</label>' +
						'<div class="layui-input-block">' +
						'<input type="text" onchange="Module.test_username()" id="username" name="username" required  lay-verify="username" placeholder="请输入用户名" autocomplete="off" class="layui-input">' +
						'<span id="s1"></span>' +
						'</div>' +
						'</div>' +  
						'<div class="layui-form-item">' +
						'<label class="layui-form-label">密码</label>' +
						'<div class="layui-input-block">' +
						'<input type="password" id="password" name="password" required  lay-verify="password" placeholder="请输入密码" autocomplete="off" class="layui-input">' +
						'</div>' +
						'</div>' +
						'<div class="layui-form-item">' +
						'<label class="layui-form-label">确认密码</label>' +
						'<div class="layui-input-block">' +
						'<input type="password" name="repassword" required  lay-verify="repassword" placeholder="请输入密码" autocomplete="off" class="layui-input">' +
						'</div>' +
						'</div>' +
						'<div class="layui-form-item">' +
						'<div class="layui-input-block">' +
						'<button type="submit" class="layui-btn" id="submit_form" lay-submit="" lay-filter="demo1">立即提交</button>' +
						'<button type="reset" class="layui-btn layui-btn-primary">重置</button>' +
						'</div>' +
						'</div>' +
						'</form>' +
						'</div>',
					area: ['320px', '350px']
				});
				//密码验证
				form.verify({
					password: [/(.+){3,12}$/, '密码必须3到12位'],
					username: [/^[a-zA-Z0-9_-]{4,16}$/, '用户名为4到16位(字母，数字，下划线，减号)'],
					nickname: [/(.+){2,8}$/, '昵称必须2到8位'],
					repassword: function(value) {
						var repassvalue = $('#password').val();
						if (value != repassvalue) {
							return '两次输入的密码不一致!';
						}
					}
				});
				//监听提交
				form.on('submit(demo1)', function(data) {
					var json_str = JSON.stringify(data.field)
					var str = JSON.parse(json_str);
					alert(str.nickname);
					//把注册信息发给后台
					$.post("http://localhost:8080/map/register.action", {
						"nickname": str.nickname,
						"username": str.username,
						"password": str.password,
						"repassword": str.repassword
					});

					layerEle.close(register_win);
					layerEle.msg('注册成功', {
						time: 1000
					});

					return false;
				});
			});
		});
	},
	forgetPwd: function() {
		window.location.href = 'http://localhost:8080/map/main/userSetting.html';
	}
}
$(function() {
	Module.init();
});